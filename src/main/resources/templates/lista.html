<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Gerenciador de Tarefas</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
          rel="stylesheet">
</head>

<body class="bg-light">

<div class="container mt-5">

    <h2 class="mb-4">Gerenciador de Tarefas</h2>

    <!-- ================= FORMULÁRIO ================= -->
    <form th:action="@{/salvar}"
          th:object="${novaTarefa}"
          method="post"
          class="row g-3 mb-4">

        <!-- ID oculto (ESSENCIAL PARA EDITAR) -->
        <input type="hidden" th:field="*{id}">

        <div class="col-md-3">
            <input type="text"
                   th:field="*{nome}"
                   class="form-control"
                   placeholder="Nome"
                   required>
        </div>

        <div class="col-md-2">
            <input type="number"
                   step="0.01"
                   min="0"
                   th:field="*{custo}"
                   class="form-control"
                   placeholder="Ex: 1500.00"
                   required>
        </div>

        <div class="col-md-2">
            <input type="date"
                   th:field="*{dataLimite}"
                   class="form-control"
                   required>
        </div>

        <div class="col-md-2">
            <input type="number"
                   th:field="*{ordemApresentacao}"
                   class="form-control"
                   placeholder="Ordem"
                   required>
        </div>

        <div class="col-md-2">
            <button type="submit"
                    class="btn btn-primary w-100"
                    th:text="${novaTarefa.id != null} ? 'Atualizar' : 'Adicionar'">
            </button>
        </div>

    </form>

    <!-- ================= TABELA ================= -->
    <table class="table table-bordered table-hover bg-white">
        <thead class="table-dark">
        <tr>
            <th>Ordem</th>
            <th>Nome</th>
            <th>Custo</th>
            <th>Data Limite</th>
            <th>Ações</th>
        </tr>
        </thead>

        <tbody>

        <tr th:each="t : ${tarefas}">
            <td th:text="${t.ordemApresentacao}"></td>

            <td th:text="${t.nome}"></td>

            <!-- MOEDA EM REAL -->
            <td th:text="${#numbers.formatCurrency(t.custo)}"></td>

            <td th:text="${t.dataLimite}"></td>

            <td>
                <a th:href="@{/subir/{id}(id=${t.id})}"
                   class="btn btn-sm btn-secondary">↑</a>

                <a th:href="@{/descer/{id}(id=${t.id})}"
                   class="btn btn-sm btn-secondary">↓</a>

                <a th:href="@{/editar/{id}(id=${t.id})}"
                   class="btn btn-sm btn-warning">Editar</a>

                <a th:href="@{/deletar/{id}(id=${t.id})}"
                   class="btn btn-sm btn-danger"
                   onclick="return confirm('Deseja excluir esta tarefa?');">
                    Excluir
                </a>
            </td>
        </tr>

        </tbody>
    </table>

    <!-- ================= TOTAL ================= -->
    <div class="mt-3">
        <h5>Total de Custos:
            <span th:text="${#numbers.formatCurrency(total)}"></span>
        </h5>
    </div>

</div>

</body>
</html>
